---
import { Image } from "astro:assets";

interface Service {
    name: string;
    url: string;
    iconUrl?: string;
    category?: string;
}

let services: Service[] = (await import("../../public/services.json")).default;

const groupedServices = services.reduce(
    (prev, current) => {
        const category = current.category || "Services";
        if (!prev[category]) prev[category] = [];
        prev[category].push(current);
        return prev;
    },
    {} as Record<string, Service[]>,
);

const categories = Object.keys(groupedServices);
---

<div class="w-full max-w-6xl">
    {
        categories.map((category) => (
            <div class="mb-8">
                <h2 class="text-xl font-medium mb-4">{category}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {groupedServices[category].map((service) => (
                        <a
                            href={service.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="group flex items-center gap-4 p-4 rounded-xl frosted-glass hover:bg-white/20 transition-all"
                        >
                            {service.iconUrl ? (
                                <img
                                    src={service.iconUrl}
                                    class="w-10 h-10 object-contain"
                                />
                            ) : (
                                <span class="text-4xl">?</span>
                            )}
                            <div class="flex flex-col">
                                <span class="font-medium truncate">
                                    {service.name}
                                </span>
                                <span class="text-xs opacity-60 truncate">
                                    {new URL(service.url).host}
                                </span>
                            </div>
                        </a>
                    ))}
                </div>
            </div>
        ))
    }
</div>
